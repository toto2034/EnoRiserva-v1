DROP DATABASE IF EXISTS enoriserva;
CREATE DATABASE IF NOT EXISTS enoriserva;
USE enoriserva;

CREATE TABLE utenti (
    id_utente INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(30) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(50),
    telefono VARCHAR(15),
    nome VARCHAR(30),
    cognome VARCHAR(30),
    tipo ENUM('cliente', 'admin', 'owner')
);

CREATE TABLE metodo_di_pagamento (
    id_utente INT PRIMARY KEY,
    numerocarta VARCHAR(16) NOT NULL,
    nometitolare VARCHAR(50) NOT NULL,
    datascadenza DATE NOT NULL,
    cvv VARCHAR(4) NOT NULL,
    circuito ENUM('Mastercard', 'Visa'),

    FOREIGN KEY (id_utente) REFERENCES utenti(id_utente)
);

CREATE TABLE ordine (
    id_ordine INT PRIMARY KEY AUTO_INCREMENT,
    id_utente INT NOT NULL,
    stato ENUM('Pagato', 'Pagamento Rifiutato') NOT NULL,
    costo_totale DECIMAL(10,2) NOT NULL,
    costo_spedizione DECIMAL(10,2) NOT NULL,
    data_ordine DATE NOT NULL,

    FOREIGN KEY (id_utente) REFERENCES utenti(id_utente)
);

CREATE TABLE fattura (
    id_ordine INT PRIMARY KEY,
    pec VARCHAR(50) NOT NULL,
    partita_iva VARCHAR(50) NOT NULL,
    CUU VARCHAR(10) NOT NULL,
    nome_societa VARCHAR(50) NOT NULL,

    FOREIGN KEY (id_ordine) REFERENCES ordine(id_ordine)
);

CREATE TABLE indirizzo (
    id_indirizzo INT PRIMARY KEY AUTO_INCREMENT,
    id_utente INT NOT NULL,
    via VARCHAR(100) NOT NULL,
    citta VARCHAR(50) NOT NULL,
    cap VARCHAR(10) NOT NULL,
    stato VARCHAR(50) NOT NULL,
    tipo ENUM('spedizione', 'fatturazione') NOT NULL,

    FOREIGN KEY (id_utente) REFERENCES utenti(id_utente)
);

CREATE TABLE prodotti (
    id_prodotto INT PRIMARY KEY AUTO_INCREMENT,
    nome VARCHAR(30) NOT NULL,
    descrizione VARCHAR(1000) NOT NULL,
    tipologia ENUM('VINO_ROSSO', 'VINO_BIANCO', 'SPUMANTE') NOT NULL,
    regione VARCHAR(30) NOT NULL,
    annata YEAR NOT NULL,
    prezzo DECIMAL(10,2) NOT NULL,
    quantita INT NOT NULL,
    img VARCHAR(1000) NOT NULL
);

CREATE TABLE carrello (
    id_utente INT NOT NULL,
    id_prodotto INT NOT NULL,
    quantita INT NOT NULL,

    PRIMARY KEY (id_utente, id_prodotto),
    FOREIGN KEY (id_utente) REFERENCES utenti(id_utente),
    FOREIGN KEY (id_prodotto) REFERENCES prodotti(id_prodotto)
);

INSERT INTO prodotti (nome, descrizione, tipologia, regione, annata, prezzo, quantita, img)
VALUES
('Amarone della Valpolicella', 'Splendido colore granato. Aromi di barbabietola arrosto, rosmarino, pomodoro essiccato al sole e fichi maturi con un palato rotondo, vibrante e fruttato. Sapori di riduzione di melograno, cioccolato e caffè fresco. Finale saporito, oliva nera. Un Amarone equilibrato, complesso e dal fascino rustico.', 'VINO_ROSSO', 'Veneto', 2015, 20.00, 40, 'https://upload.wikimedia.org/wikipedia/commons/6/6f/Amarone_red_wine.jpg'),
('Montepulciano D’Abruzzo', 'Vino rosso morbido e fruttato...', 'VINO_ROSSO', 'Abruzzo', 2022, 16.00, 120, 'https://upload.wikimedia.org/wikipedia/commons/8/8f/Montepulciano_D%27Abruzzo_wine_and_bottle.jpg'),
('Monaco Rosso Taurasi', 'Il naso è aromatico, tostato...', 'VINO_ROSSO', 'Campania', 2015, 40.00, 80, 'https://upload.wikimedia.org/wikipedia/commons/0/0d/Barolo_bottle.jpg'),
('Chianti Classico', 'Prodotto nella zona di produzione più antica...', 'VINO_ROSSO', 'Toscana', 2019, 22.00, 50, 'https://upload.wikimedia.org/wikipedia/commons/d/d2/Chianti_classico_bottle.jpg'),
('Cannubi Barolo', 'Colore rubino scuro brillante...', 'VINO_ROSSO', 'Piemonte', 2020, 160.00, 40, 'https://upload.wikimedia.org/wikipedia/commons/4/47/Barolo_Vineyards_and_Wine_Bottle.jpg'),
('Fiano D’Avellino', 'Nel calice questo vino è colore giallo paglierino...', 'VINO_BIANCO', 'Campania', 2022, 25.00, 90, 'https://upload.wikimedia.org/wikipedia/commons/f/f6/Fiano_di_Avellino.jpg'),
('Greco Di Tufo', 'Particolarmente fruttato e di facile riconoscimento...', 'VINO_BIANCO', 'Campania', 2021, 13.50, 110, 'https://upload.wikimedia.org/wikipedia/commons/5/58/Greco_di_Tufo_Cantina.jpg'),
('Elisena', 'Buona acidità supportata da una inaspettata morbidezza...', 'VINO_BIANCO', 'Sicilia', 2022, 26.00, 70, 'https://upload.wikimedia.org/wikipedia/commons/e/ee/Sicilian_white_wine.jpg'),
('Queto Grillo', 'Vino prodotto da uve grillo coltivate in biologico...', 'VINO_BIANCO', 'Sicilia', 2023, 12.00, 60, 'https://upload.wikimedia.org/wikipedia/commons/b/bd/Grillo_wine.jpg'),
('Trebbiano D’Abruzzo', 'Vino ricco, elegante, sapido e mediterraneo...', 'VINO_BIANCO', 'Abruzzo', 2018, 55.00, 70, 'https://upload.wikimedia.org/wikipedia/commons/5/5d/Trebbiano_d%27Abruzzo.jpg'),
('Franciacorta Brut', 'Franciacorta Brut Bosio ha un colore giallo paglierino...', 'SPUMANTE', 'Lombardia', 2020, 25.00, 60, 'https://upload.wikimedia.org/wikipedia/commons/3/34/Franciacorta.jpg'),
('Asti Spumante', 'Da vigneti coltivati a Moscato bianco...', 'SPUMANTE', 'Piemonte', 2024, 14.00, 150, 'https://upload.wikimedia.org/wikipedia/commons/c/c8/Asti_spumante_bottle.jpg'),
('Lambrusco Di Sorbara', 'Vino rosso secco, frizzante...', 'SPUMANTE', 'Emilia-Romagna', 2022, 10.00, 130, 'https://upload.wikimedia.org/wikipedia/commons/1/19/Lambrusco.jpg'),
('Moët & Chandon', 'Champagne francese brut...', 'SPUMANTE', 'Francia', 2022, 65.00, 20, 'https://upload.wikimedia.org/wikipedia/commons/1/1f/Moet-Chandon-Champagne.jpg'),
('Veuve Clicquot', 'Predomina il Pinot Noir che conferisce il forte carattere...', 'SPUMANTE', 'Francia', 2021, 55.00, 25, 'https://upload.wikimedia.org/wikipedia/commons/f/fd/Veuve_Clicquot.jpg');